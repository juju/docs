<!DOCTYPE html> 
<html>
<!--Head-->
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Juju Documentation</title>
		<script src="/wp-content/themes/ubuntu/library/js/all-yui.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Ubuntu:400,300,300italic,400italic,700,700italic|Ubuntu+Mono" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/reset.css" />
 		<link rel="shortcut icon" href="//assets.ubuntu.com/sites/ubuntu/latest/u/img/favicon.ico" />
		<link rel="stylesheet" type="text/css" media="screen" href="//assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="//assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/960.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/home-new.css" />
		<link href="./css/main.css" rel="stylesheet" type="text/css" />
		
		<!--[if lt IE 9]>
		<script type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
<!--End-Head-->


<body class="resources">
  	
<!--Header-->

	<header class="banner global" role="banner">
		<nav role="navigation" class="nav-primary nav-right">
			<div class="logo">
				<a class="logo-ubuntu" href="https://juju.ubuntu.com/">
					<img width="118" height="27" src="//assets.ubuntu.com/sites/ubuntu/latest/u/img/logo.png" alt="Juju logo" />
					<span>Juju</span>
				</a>
			</div>
			<ul>
				<li class="accessibility-aid"><a accesskey="s" href="#main-content">Jump to content</a></li>
				<li class="page_item page-item-8"><a href="https://juju.ubuntu.com/charms/">Charms</a></li>
				<li class="page_item page-item-10"><a href="https://juju.ubuntu.com/features/">Features</a></li>
				<li class="page_item page-item-12"><a href="https://juju.ubuntu.com/deployment/">Deploy</a></li>
				<li class="page_item page-item-14"><a href="https://juju.ubuntu.com/resources/">Resources</a></li>
				<li class="page_item page-item-16"><a href="https://juju.ubuntu.com/community/">Community</a></li>
				<li class="page_item page-item-18"><a href="https://juju.ubuntu.com/download/">Install Juju</a></li>
			</ul>
			<div id="box-search">
				<form class="search-form" method="get" id="searchform" action="https://juju.ubuntu.com/">
					<label class="off-left" for="s">Search:</label>
					<input class="form-text" type="text" value="" name="s" id="s" />
					<button class="off-left form-submit" type="submit" id="searchsubmit">Search</button>
				</form>		
			</div>
		</nav>	
	</header>
<!--End-Header-->
<!--Preamble-->
<div class="wrapper">
  <div id="main-content" class="inner-wrapper" role="main">
    <div class="row no-border">
     <div class="header-navigation-secondary"></div>
     <h2 class="pagetitle">Juju documentation</h2>
    </div>
    <section id="content" class="container-12">
      <div class="grid-12 doc-container">
        <div id="navlinks" class="grid-3 doc-navigation">LINKS</div>
        <div class="grid-9 doc-content">
<!--End-Preamble-->
          <article>
            <section>
            <h1 id="config-local">Configuring for KVM</h1>

            <h2 id="prereq">Prerequisites</h2>
            <p>Juju can deploy to KVM in addition to LXC. This setup will show you how to deploy to both LXC and KVM within a single environment.</p>
            <p>If you have an existing KVM environment that you want to connect Juju to, we recommend using the <a href="/docs/config-manual.html">manual provider</a>.</p>

            <p>If you're not already using the stable release PPA you can make sure you've added it:</p> 

<pre class="prettyprint lang-bash">
sudo apt-add-repository ppa:juju/stable
sudo apt-get update</pre>

			<p>Then you can install the local provider, the commands depend on the Juju version you are using:</p>

			<h3 id="gt-precise">For Ubuntu versions newer than 12.04:</h3>

<pre class="prettyprint lang-bash">
sudo apt-get install juju-local libvirt-bin
</pre>

			<h3 id="precise">For 12.04 LTS users only:</h3>

			<p>Due to needing newer versions of LXC the local provider does require a newer kernel than the released version of 12.04. Therefore we install Linux 3.8 from the <a href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack">LTS Hardware Enablement Stack</a>:</p> 

<pre class="prettyprint lang-bash">
sudo apt-get install juju-local linux-image-generic-lts-raring linux-headers-generic-lts-raring libvirt-bin
</pre>

			<p>You will need to reboot into the new kernel in order to use Juju with the local provider.</p>

			<p>If you're not running Ubuntu please consult your operating system distribution's documentation for instructions on installing the LXC userspace tools and the MongoDB server. Juju requires a MongoDB server built with SSL support.</p>

            <h2 id="configuration">Configuration</h2>
            <p>You should start by generating a generic configuration file for Juju and then switching to the local provider by using the command:</p>
<pre class="prettyprint lang-bash">
juju generate-config
juju switch local
</pre>
            <p>This will generate a file, <code>environments.yaml</code> (if it doesn't already exist), which will live in your <code>~/.juju/</code> directory (and will create the directory if it doesn't already exist).</p>
            <p class ="note"><strong>Note:</strong> If you have an existing configuration, you can use <code>juju generate-config --show</code> to output the new config file, then copy and paste relevant areas in a text editor etc.</p>
            <p>The generic configuration sections generated for the local provider will look something like this, though Juju will generate this automatically you usually don't need to edit it, however do ensure that
            <tt>network-bridge</tt> is set, you'll need that for the KVMs to talk to each other. Check the <a href="http://wiki.libvirt.org/page/Networking#Bridged_networking_.28aka_.22shared_physical_device.22.29">KVM networking documentation</a> for more information.</p>
<pre class="prettyprint lang-yaml">
## https://juju.ubuntu.com/get-started/local/
local:
    type: local
    admin-secret: 772b9471131c6b5883475e3908156d32
    network-bridge: virbr0
</pre>

            <p>Running Juju with this configuration the storage files and the database will be located in the directory specified by the environment variable <code>$JUJU_HOME</code>, which defaults to <code>~/.juju/</code>. By uncommenting and setting <code>root-dir</code> this location can be changed as well as the ports of the storage and the shared storage. This may be useful in the case of multiple parallel running local providers or conflicts with other programs on your system.</p>
 
            <p class="note" id="encrypted-home"><strong>Note: </strong>If you are using encrypted home directories you have to set <code>$JUJU_HOME</code> or <code>root-dir</code> to point to a location <strong>outside</strong> your home directory.</p>

            <h2 id="bootstrap-destroy">Bootstrapping and Destroying</h2>
            <p>The usage of LXC Linux Containers requires <strong>root</strong> privileges for some steps. Juju will prompt for your password if needed. Juju cannot be run under sudo because it needs to manage permission as the real user.</p>
            <p clas ="note"><strong>Note:</strong> If you are running a firewall such as <strong>ufw</strong>, it may interfere with the correct operation of Juju using LXC containers and might need to be halted.</p>
            <p class="note">If you have used the local provider in the past when it required <code>sudo</code>, you may need to manually clean up some files that are still owned by root. If your local environment is named "local" then there may be a local.jenv owned by root in the JUJU_HOME directory (~/.juju). After the local environment is destroyed, you can remove the file like this:</p>
<pre class="prettyprint lang-bash">
sudo rm ~/.juju/environments/local.jenv
</pre>

			<h2 id="deploy-kvm">Deploying to KVM</h2>
			<p>After bootstrapping, you can deploy services to KVM:</p>
<pre class="prettyprint lang-bash">
juju bootstrap
juju deploy mysql --to kvm:0
juju deploy wordpress
</pre>
            What this does is deploy mysql onto a KVM instance within Machine 0 and deploys wordpress onto an LXC instance which is Machine 1 by default. The juju status output should look similar to this:
<pre class="prettyprint lang-bash">
environment: local
machines:
  "0":
    agent-state: started
    agent-version: 1.17.5.1
    dns-name: localhost
    instance-id: localhost
    series: saucy
    containers:
      0/kvm/0:
        agent-state: started
        agent-version: 1.17.5.1
        dns-name: 192.168.122.233
        instance-id: juju-machine-0-kvm-0
        series: precise
        hardware: arch=amd64 cpu-cores=1 mem=512M root-disk=8192M
  "1":
    agent-state: started
    agent-version: 1.17.5.1
    dns-name: 192.168.122.204
    instance-id: adam-local-machine-1
    series: precise
    hardware: arch=amd64
services:
  mysql:
    charm: cs:precise/mysql-38
    exposed: false
    relations:
      cluster:
      - mysql
      db:
      - wordpress
    units:
      mysql/0:
        agent-state: installed
        agent-version: 1.17.5.1
        machine: 0/kvm/0
        public-address: 192.168.122.233
  wordpress:
    charm: cs:precise/wordpress-21
    exposed: true
    relations:
      db:
      - mysql
      loadbalancer:
      - wordpress
    units:
      wordpress/0:
        agent-state: started
        agent-version: 1.17.5.1
        machine: "1"
        open-ports:
        - 80/tcp
        public-address: 192.168.122.204
</pre>

<p>You can verify instances using <tt>virsh</tt> and <tt>lxc-ls --fancy</tt>. As another example
you can continue to deploy to KVM on certain machines, in this case node 0:</p>

<pre class="prettyprint lang-bash">
juju deploy mongodb --to kvm:0
juju deploy rails --to kvm:0
juju deploy wikipedia --to kvm:0
</pre>
</section>

            
          </article>
<!--Postamble-->
        </div>
      </div>
    </section>
  </div>
</div>
<!--End-Postamble-->
<!--Footer-->
	<footer class="global clearfix" role="contentinfo">
		<nav role="navigation">
			<div class="footer-a">
				<div class="clearfix">
					<ul>
						<li>
							<h2><a href="/">Juju</a></h2>
							<ul>
								<li><a href="/charms/">Charms</a></li>
								<li><a href="/features/">Features</a></li>
								<li><a href="/deployment/">Deployment</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="/resources/">Resources</a></h2>
							<ul>
								<li><a href="/resources/overview/">Overview</a></li>
								<li><a href="/docs/">Documentation</a></li>
								<li><a href="/resources/juju-gui/">The Juju web UI</a></li>
								<li><a href="/docs/authors-charm-store.html">The charm store</a></li>
								<li><a href="/docs/getting-started.html#test">Tutorial</a></li>
								<li><a href="/resources/videos/">Videos</a></li>
								<li><a href="/resources/easy-tasks-for-new-developers/">Easy tasks for new developers</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="/community">Community</a></h2>
							<ul>
								<li><a href="/community/blog/">Juju Blog</a></li>
								<li><a href="/events/">Events</a></li>
								<li><a href="/community/weekly-charm-meeting/">Weekly charm meeting</a></li>
								<li><a href="/community/charmers/">Charmers</a></li>
								<li><a href="/docs/authors-charm-writing.html">Write a charm</a></li>
								<li><a href="/docs/contributing.html">Help with documentation</a></li>
								<li><a href="https://bugs.launchpad.net/juju-core/+filebug">File a bug</a></li> <li><a href="/communiy/labs/">Juju Labs</a></li>
							</ul>
						</li>
						<li>
							<h2><a href="https://jujucharms.com/sidebar/">Try Juju</a></h2>
							<ul>
								<li><a href="https://jujucharms.com/">Charm store</a></li>
								<li><a href="/download/">Download Juju</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="legal clearfix">
			<p>&copy; 2013-2014 Canonical Ltd. Ubuntu and Canonical are registered trademarks of <a href="http://www.canonical.com">Canonical Ltd</a>.</p>
		</div>
	</footer>

<!--End-Footer-->




<!--Scripts-->
    <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js"></script>
    <script src="//d38yea5fb4e2oh.cloudfront.net/jquery.stacktack.min.js"></script>    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="./js/main.js"></script>
    <script type="text/javascript" src="./js/jquery.details.js"></script>
    <script src="//assets.ubuntu.com/sites/ubuntu/latest/u/js/core.js"></script>
    <script src="//assets.ubuntu.com/sites/ubuntu/latest/u/js/global.js"></script>
    <!-- google analytics -->
    <script>
   var _gaq = _gaq || [];
   _gaq.push(['_setAccount', 'UA-1018242-41']);
   _gaq.push(['_trackPageview']);
  
   (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
    </script>
<!--End-Scripts-->








</body></html>
