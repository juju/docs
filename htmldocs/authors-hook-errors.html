<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Juju Documentation</title>
    <script src="/wp-content/themes/ubuntu/library/js/all-yui.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,300,300italic,400italic,700,700italic|Ubuntu+Mono" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/reset.css">
    <link rel="shortcut icon" href="//assets.ubuntu.com/sites/ubuntu/latest/u/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" media="screen" href="//assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="//assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/960.css">
    <link rel="stylesheet" type="text/css" media="screen" href="https://juju.ubuntu.com/wp-content/themes/juju-website/css/home-new.css">
    <link rel="stylesheet" id="stacktack-css" href="https://juju.ubuntu.com/wp-content/plugins/stacktack/css/stacktack.min.css?ver=3.4.2" type="text/css" media="all">
    <link href="./css/main.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="resources">
    <header class="banner global" role="banner">
      <nav role="navigation" class="nav-primary nav-right">
        <div class="logo">
          <a class="logo-ubuntu" href="https://juju.ubuntu.com/">
            <img width="118" height="27" src="//assets.ubuntu.com/sites/ubuntu/latest/u/img/logo.png" alt="Juju logo" />
            <span>Juju</span>
          </a>
        </div>
        <ul>
          <li class="accessibility-aid"><a accesskey="s" href="#main-content">Jump to content</a></li>
          <li class="page_item page-item-8"><a href="https://juju.ubuntu.com/charms/">Charms</a></li>
          <li class="page_item page-item-10"><a href="https://juju.ubuntu.com/features/">Features</a></li>
          <li class="page_item page-item-12"><a href="https://juju.ubuntu.com/deployment/">Deploy</a></li>
          <li class="page_item page-item-14"><a href="https://juju.ubuntu.com/resources/">Resources</a></li>
          <li class="page_item page-item-16"><a href="https://juju.ubuntu.com/community/">Community</a></li>
          <li class="page_item page-item-18"><a href="https://juju.ubuntu.com/download/">Install Juju</a></li>
        </ul>
        <div id="box-search">
          <form class="search-form" method="get" id="searchform" action="https://juju.ubuntu.com/">
            <label class="off-left" for="s">Search:</label>
            <input class="form-text" type="text" value="" name="s" id="s" />
            <button class="off-left form-submit" type="submit" id="searchsubmit">Search</button>
          </form>
        </div>
      </nav>
    </header>
    <div class="wrapper">
      <div id="main-content" class="inner-wrapper" role="main">
        <div class="row no-border">
         <div class="header-navigation-secondary"></div>
         <h2 class="pagetitle">Juju documentation</h2>
        </div>
        <section id="content" class="container-12">
          <div class="grid-12 doc-container">
            <div id="navlinks" class="grid-3 doc-navigation">
                          <h1>User Guide</h1>
            <ul class="no-margin">
              <li class=""><a href="getting-started.html">Getting Started</a></li>
              <li class=" sub"><a href="config-aws.html">Amazon Web Service</a></li>
              <li class=" sub"><a href="config-azure.html">Windows Azure</a></li>
              <li class=" sub"><a href="config-hpcloud.html">HP Public Cloud</a></li>
              <li class=" sub"><a href="config-joyent.html">Joyent</a></li>
              <li class=" sub"><a href="config-openstack.html">OpenStack</a></li>
              <li class=" sub"><a href="config-maas.html">MAAS (bare metal)</a></li>
              <li class=" sub"><a href="config-local.html">Local</a></li>
              <li class=" sub"><a href="config-vagrant.html">Vagrant</a></li>
              <li class=" sub"><a href="config-manual.html">Manual Provisioning</a></li>
              <li class=" sub"><a href="getting-started.html#test">Testing your setup</a></li>
              <li class=""><a href="charms.html">Using Charms</a></li>
              <li class=" sub"><a href="charms-deploying.html">Deploying Services</a></li>
              <li class=" sub"><a href="charms-constraints.html">Using constraints</a></li>
              <li class=" sub"><a href="charms-config.html">Service Configuration</a></li>
              <li class=" sub"><a href="charms-relations.html">Service Relationships</a></li>
              <li class=" sub"><a href="charms-exposing.html">Exposing Services</a></li>
              <li class=" sub"><a href="charms-scaling.html">Scaling Services</a></li>
              <li class=" sub"><a href="charms-service-groups.html">Groups of Services</a></li>
              <li class=" sub"><a href="charms-destroy.html">Destroying Services</a></li>
              <li class=" sub"><a href="charms-environments.html">Managing environments</a></li>
              <li class=" sub"><a href="charms-bundles.html">Using bundles</a></li>
              <li class=""><a href="howto.html">How to...</a></li>
              <li class=" sub"><a href="howto-node.html">Deploy a Node.js app</a></li>
              <li class=" sub"><a href="howto-rails.html">Test and deploy on Rails</a></li>
              <li class=" sub"><a href="howto-backup-restore.html">Backup and Restore</a></li>
              <li class=" sub"><a href="howto-gui-management.html">Manage Juju with the GUI</a></li>
              <li class=" sub"><a href="howto-privatecloud.html">Set up a Private Cloud</a></li>
              <li class=" sub"><a href="howto-proxies.html">Configure Proxy Access</a></li>
              <li class="sub"><a href="howto-vagrant-workflow.html">Vagrant Workflow</a></li>
              <li class="sub"><a href="howto-authorised-keys.html">Manage Authorised Keys</a></li>
              <li class=""><a href="troubleshooting-local.html">Troubleshooting</a></li>
            </ul>
            <h1>Charm Authors</h1>
            <ul class="no-margin">
              <li class=""><a href="authors-intro.html">Getting started</a></li>
              <li class=""><a href="authors-charm-components.html">Components of a charm</a></li>
              <li class=" sub"><a href="authors-charm-metadata.html">metadata.yaml</a></li>
              <li class=" sub"><a href="authors-charm-hooks.html">/hooks</a></li>
              <li class=" sub"><a href="authors-charm-config.html">config.yaml</a></li>
              <li class=""><a href="authors-charm-writing.html">Charm walkthrough</a></li>
              <li class=" sub"><a href="authors-hook-environment.html">How hooks are run</a></li>
              <li class=" sub"><a href="authors-relations-in-depth.html">Relations lifecycle</a></li>
              <li class=" sub"><a href="authors-charm-interfaces.html">Implementing interfaces</a></li>
              <li class=" sub"><a href="authors-hook-errors.html">Hook Errors</a></li>
              <li class=" sub"><a href="authors-hook-debug.html">Hook Debugging</a></li>
              <li class="sub"><a href="authors-subordinate-services.html">Subordinate services</a></li>
              <li class="sub"><a href="authors-implicit-relations.html">Implicit Relations</a></li>
              <li class="sub"><a href="authors-testing.html">Charm Testing</a></li>


              <li class=""><a href="authors-charm-store.html">The Juju Charm Store</a></li>
              <li class=" sub"><a href="authors-charm-store.html#submitting">Submit a charm</a></li>
              <li class=" sub"><a href="authors-charm-policy.html">Charm store policy</a></li>
              <li class=" sub"><a href="authors-charm-best-practice.html">Best practices</a></li>
              <li class=" sub"><a href="authors-charm-quality.html">Charm Feature Rating</a></li>
              <li class=" sub"><a href="authors-charm-icon.html">Charm Icons</a></li>
            </ul>

            <h1>Tools</h1>
            <ul class="no-margin">
              <li class=""><a href="tools-charm-tools.html">Charm Tools</a></li>
              <li class=""><a href="tools-amulet.html">Amulet</a></li>
            </ul>

            <h1>Reference</h1>
            <ul class="no-margin">
              <li class="sub"><a href="commands.html">Juju commands</a></li>
              <li class="sub"><a href="reference-constraints.html">Juju constraints</a></li>
              <li class="sub"><a href="reference-release-notes.html">Release notes</a></li>
              <li class="sub"><a href="glossary.html">Glossary</a></li>
              <li class="sub"><a href="reference-reviewers.html">Charm Review Criteria</a></li>
              <li class="sub"><a href="contributing.html">Contribute to the Docs!</a></li>
            </ul>
            </div>
            <div class="grid-9 doc-content">
              <article>
                <h1 id="hook-errors">Hook errors</h1>
<p>If any of your hooks returns a non-zero exit code, juju will stop managing the
unit directly and will wait for user intervention. This is a Bad Thing, and you
should make every effort to avoid it, because the average user may not be in a
position to diagnose the fault with any great degree of sophistication.</p>
<p>So, in general, you should write your hooks as robustly as possible: if an
operation suffers a possibly-transient failure, it's wise to wait a moment and
retry a couple of times, to avoid needlessly bothering the user with a decision
or call to action that they're not necessarily equipped to make.</p>
<p>However, you will no doubt encounter errors on occasion -- in particular, if the
unit agent is aborted while it's running a hook, it'll set an error status for
that hook when it comes back up. You will in that case have to deal with users'
potentially underinformed responses to those errors.</p>
<h2 id="error-status">Error status</h2>
<p>When a unit agent sets an error status, it stops running hooks and relinquishes
control over the charm directory. This means that it's generally safe to <code>juju
ssh</code> into the unit and use it as though you were the sole administrator; juju
will only take back control of the directory when explicitly requested, in
response to either <code>juju resolved</code> or <code>juju upgrade-charm --force</code>.</p>
<ul>
<li><code>juju resolved</code> causes the unit to unblock itself and continue as though the hook had completed successfuly. The ideal charm will be aware of this possibility and will therefore trust information from its <a href="./authors-hook-environment.html">environment</a> to be more recent and correct than anything it may have previously have recorded in the local <a href="./authors-charm-components.html">charm directory</a>.</li>
<li><code>juju resolved --retry</code> reverts the charm directory's contents to whatever they were at the start of the failed hook, and runs the hook again exactly as before. This, in combination with the <a href="./authors-hook-debug.html">debug-hooks</a> command, is your main entry point for investigating an error in detail. If the hook fails again when retried, it will set an error as before and wait again for user resolution.</li>
<li><code>juju upgrade-charm --force</code> merges into the charm directory the contents of the newer charm version, and continues blocking in the original hook error state. Each time a new upgrade is forced, the charm directory is rolled back to the state from which it was originally upgraded before proceeding; this means that a forced upgrade back to the original charm will always be a no-op, regardless of what other upgrade attempts have been made in the interim.</li>
</ul>
<p>Once you have issued one of the above commands, the charm directory should once
again be treated as inaccessible.</p>
<h2 id="charm-upgrade-errors">Charm upgrade errors</h2>
<p>Finally, there's another reason a unit might set an error status: a <a href="./authors-charm-upgrades.html">charm
upgrade</a> conflict, which should never happen
except during development.</p>
<p>They can be resolved either by forcing an upgrade to a different charm version,
or by manually resolving the git conflicts in the charm directory and running
<code>juju resolved</code> to cause the unit agent to continue.</p>
<h2 id="charm-integrity-errors">Charm integrity errors</h2>
<p>Some charms use symlinks to redirect hook execution to a common file. Naturally
these symlinks must be preserved to allow proper operation of the charm. If you
are developing a charm and manually copy it over to a system, you should verify
that the hook symlinks are preserved as expected. For example, <code>scp</code> will follow
symlinks, not replicate them, which can lead to a broken charm.</p>
<p>We recommend using either <code>rsync</code> or generating a tarball of your charm first if you're going to use <code>scp</code>.</p>
              </article>
            </div>
          </div>
        </section>
      </div>
    </div>
    <footer class="global clearfix" role="contentinfo">
      <nav role="navigation">
        <div class="footer-a">
          <div class="clearfix">
            <ul>
             <li>
               <h2><a href="/">Juju</a></h2>
               <ul>
                 <li><a href="/charms">Charms</a></li>
                 <li><a href="/features">Features</a></li>
                 <li><a href="/deployment">Deployment</a></li>
               </ul>
             </li>
             <li>
               <h2><a href="/resources">Resources</a></h2>
               <ul>
                 <li><a href="/resources/juju-overview/">Overview</a></li>
                 <li><a href="/docs/">Documentation</a></li>
                 <li><a href="/resources/the-juju-gui/">The Juju web UI</a></li>
                 <li><a href="/docs/authors-charm-store.html">The charm store</a></li>
                 <li><a href="/docs/getting-started.html#test">Tutorial</a></li>
                 <li><a href="/resources/videos/">Videos</a></li>
                 <li><a href="/resources/easy-tasks-for-new-developers/">Easy tasks for new developers</a></li>
               </ul>
             </li>
             <li>
               <h2><a href="/community">Community</a></h2>
                 <ul>
                   <li><a href="/community/blog/">Juju Blog</a></li>
                   <li><a href="/events/">Events</a></li>
                   <li><a href="/community/weekly-charm-meeting/">Weekly charm meeting</a></li>
                   <li><a href="/community/charmers/">Charmers</a></li>
                   <li><a href="/docs/authors-charm-writing.html">Write a charm</a></li>
                   <li><a href="/docs/contributing.html">Help with documentation</a></li>
                   <li><a href="https://bugs.launchpad.net/juju-core/+filebug">File a bug</a></li>
                   <li><a href="/labs/">Juju Labs</a></li>
                 </ul>
               </li>
               <li>
                 <h2><a href="https://jujucharms.com/sidebar/">Try Juju</a></h2>
                 <ul>
                   <li><a href="https://jujucharms.com/">Charm store</a></li>
                   <li><a href="/download/">Download Juju</a></li>
                 </ul>
               </li>
             </ul>
           </div>
         </div>
       </nav>
       <div class="legal clearfix">
         <p>&copy; 2013 Canonical Ltd. Ubuntu and Canonical are registered trademarks of <a href="http://canonical.com">Canonical Ltd</a>.</p>
       </div>
     </footer>
     <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
     <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
     <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js"></script>
     <script src="//d38yea5fb4e2oh.cloudfront.net/jquery.stacktack.min.js"></script>
     <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
     <script type="text/javascript" src="./js/main.js"></script>
     <script type="text/javascript" src="./js/jquery.details.js"></script>
     <script src="//assets.ubuntu.com/sites/ubuntu/latest/u/js/core.js"></script>
     <script src="//assets.ubuntu.com/sites/ubuntu/latest/u/js/global.js"></script>
     <!-- google analytics -->
     <script>
       var _gaq = _gaq || [];
       _gaq.push(['_setAccount', 'UA-1018242-41']);
       _gaq.push(['_trackPageview']);

       (function() {
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>
  </body>
</html>
